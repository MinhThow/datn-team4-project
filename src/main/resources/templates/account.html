<!doctype html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Male-Fashion |Account Center</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-LN+7fdVzj6u52u30Kp6M/trliBMCMKTyK833zpbD+pXdCLuTusPj697FH4R/5mcr" crossorigin="anonymous">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

	<link rel="stylesheet" href="/css/account.css" type="text/css">
</head>

<body class="d-flex flex-column min-vh-100">
	<main class="flex-grow-1">
		<div class="container-fluid">
			<nav class="navbar navbar-expand-lg bg-white border-bottom shadow-sm">
				<div class="container d-flex justify-content-between align-items-center position-relative">


					<!-- Logo + Home cùng bên trái -->
					<div class="d-flex align-items-center">
						<a class="navbar-brand d-flex align-items-center me-3" href="/">
							<img src="/img/logo.png" alt="Logo" class="d-inline-block align-text-top me-2">
						</a>
						<a href="/" class="nav-link home-link text-dark fw-semibold">Trang chủ</a>
					</div>

					<!-- Tiêu đề ở giữa tuyệt đối -->
					<div class="position-absolute top-50 start-50 translate-middle">
						<span class="fw-bold fs-5 text-dark">Tài khoản</span>
					</div>

					<div>
						<a href="/logout" class="nav-link home-link text-dark fw-semibold d-flex align-items-center">
							<i class="bi bi-box-arrow-right me-1"></i> Đăng xuất
						</a>
					</div>
				</div>
			</nav>
		</div>
		<!-- Big TABS -->
		<div class="container mt-4">
			<div class="row gx-0">
				<!-- Tab Lớn (Vertical Nav) -->
				<div class="col-md-3 pe-2">
					<div class="nav flex-column nav-pills custom-vertical-tab" id="v-pills-tab" role="tablist"
						aria-orientation="vertical">
						<button class="nav-link active" id="v-pills-security-tab" data-bs-toggle="pill"
							data-bs-target="#v-pills-security" type="button" role="tab">Bảo mật</button>
						<button class="nav-link" id="v-pills-order-tab" data-bs-toggle="pill"
							data-bs-target="#v-pills-order" type="button" role="tab">Đơn hàng</button>
						
					</div>
				</div>

				<!-- Nội dung tab lớn -->
				<div class="col-md-6 ps-2">
					<div class="tab-content" id="v-pills-tabContent">
						<!-- SECURITY -->
						<div class="tab-pane fade show active" id="v-pills-security" role="tabpanel">
							<!-- Tabs nhỏ bên trong  -->
							<ul class="nav custom-underline-nav" id="myTab" role="tablist">
								<li class="nav-item" role="presentation">
									<button class="nav-link active" id="account-tab" data-bs-toggle="tab"
										data-bs-target="#account-tab-pane" type="button" role="tab"
										aria-controls="account-tab-pane" aria-selected="true">Tài khoản</button>
								</li>
								<li class="nav-item" role="presentation">
									<button class="nav-link" id="password-tab" data-bs-toggle="tab"
										data-bs-target="#password-tab-pane" type="button" role="tab"
										aria-controls="password-tab-pane" aria-selected="false">Mật khẩu</button>
								</li>


							</ul>

							<div class="tab-content" id="myTabContent" style="min-height: 600px;">
								<div class="tab-pane fade show active" id="account-tab-pane" role="tabpanel"
									aria-labelledby="account-tab" tabindex="0">
									<!-- Nội dung Account Details ở đây -->
									<div class="w-75 mt-4">
										<form id="accountForm" th:action="@{/account}" th:object="${user}"
											method="post">



											<div class="mb-3">
												<label for="userId" class="form-label">ID</label>
												<input type="text" class="form-control" id="userId" th:value="*{userId}"
													disabled>
												<input type="hidden" th:field="*{userId}" />
											</div>

											<div class="mb-3">
												<label for="name" class="form-label">Tên</label>
												<input type="text" class="form-control" id="name" th:field="*{name}">
											</div>

											<div class="mb-3">
												<label for="email" class="form-label">Email</label>
												<input type="email" class="form-control" id="email" th:field="*{email}"
													disabled>
											</div>

											<div class="mb-3">
												<label for="phone" class="form-label">Số điện thoại</label>
												<input type="text" class="form-control" id="phone" th:field="*{phone}">
											</div>

											<div class="mb-3">
												<label for="address" class="form-label">Địa chỉ</label>
												<input type="text" class="form-control" id="address"
													th:field="*{address}">
											</div>

											<div class="mb-3">
												<label for="createdAt" class="form-label">Tạo ngày</label>
												<input type="text" class="form-control" id="createdAt"
													th:value="${user.createdAt}" disabled>
											</div>

											<div class="text-center">
												<button type="submit" class="btn btn-danger">Cập nhật</button>
											</div>
										</form>
									</div>

								</div>
								<div class="tab-pane fade" id="password-tab-pane" role="tabpanel"
									aria-labelledby="password-tab" tabindex="0">
									<!-- Nội dung Password ở đây -->
									<div class="w-75 mt-4">
										<form id="passwordForm" th:action="@{/account/change-password}" method="post">
											<div class="mb-3">
												<label for="currentPassword" class="form-label">Mật khẩu cũ</label>
												<div class="input-group">
													<input type="password" class="form-control" id="currentPassword"
														name="currentPassword" required>
													<button type="button"
														class="btn btn-outline-secondary toggle-password"
														data-target="currentPassword"><i class="bi bi-eye"></i></button>
												</div>
											</div>

											<div class="mb-3">
												<label for="newPassword" class="form-label">Mật khẩu mới</label>
												<div class="input-group">
													<input type="password" class="form-control" id="newPassword"
														name="newPassword" required>
													<button type="button"
														class="btn btn-outline-secondary toggle-password"
														data-target="newPassword"><i class="bi bi-eye"></i></button>
												</div>
											</div>
											<div class="mb-3">
												<label for="confirmPassword" class="form-label">Xác nhận lại mật khẩu</label>
												<div class="input-group">
													<input type="password" class="form-control" id="confirmPassword"
														name="confirmPassword" required>
													<button type="button"
														class="btn btn-outline-secondary toggle-password"
														data-target="confirmPassword"><i class="bi bi-eye"></i></button>
												</div>
												<div id="passwordError" class="text-danger mt-1" style="display: none;">
													Mật khẩu không khớp
												</div>
											</div>
											<div class="text-center">
												<button type="submit" class="btn btn-danger">Đổi mật khẩu</button>
											</div>
										</form>
									</div>

								</div>




							</div>
						</div>

						<!-- ORDER -->
						<div class="tab-pane fade" id="v-pills-order" role="tabpanel">
							<ul class="nav custom-underline-nav mt-3" role="tablist">
								<li class="nav-item" role="presentation">
									<button class="nav-link active" id="all-tab" data-bs-toggle="tab"
										data-bs-target="#all-pane" type="button" role="tab">Tất cả</button>
								</li>
								<li class="nav-item" role="presentation">
									<button class="nav-link" id="delivering-tab" data-bs-toggle="tab"
										data-bs-target="#delivering-pane" type="button" role="tab">Đơn đang giao</button>
								</li>
								<li class="nav-item" role="presentation">
									<button class="nav-link" id="completed-tab" data-bs-toggle="tab"
										data-bs-target="#completed-pane" type="button" role="tab">Đơn hoàn thành</button>
								</li>
								<li class="nav-item" role="presentation">
									<button class="nav-link" id="canceled-tab" data-bs-toggle="tab"
										data-bs-target="#canceled-pane" type="button" role="tab">Đơn hủy</button>
								</li>
							</ul>

							<div class="tab-content mt-3" style="min-height: 600px;">

								<!-- Tab All -->
								<div class="tab-pane fade show active" id="all-pane" role="tabpanel">
									<!-- ✅ Nếu KHÔNG có đơn hàng -->
									<div th:if="${#lists.isEmpty(allOrders)}" class="text-center text-muted mt-5">
										<i class="bi bi-bag-x" style="font-size: 2rem;"></i>
										<p class="mt-2">Không có đơn hàng nào.</p>
									</div>

									<!-- ✅ Nếu CÓ đơn hàng -->
									<div th:each="order : ${allOrders}" class="card shadow-sm mb-3">
										<div class="card-body">
											<!-- Tiêu đề đơn hàng -->
											<div class="d-flex justify-content-between align-items-start mb-2">
												<h6 class="mb-3">Đơn #[[${order.orderId}]]</h6>
												<span class="badge"
													th:classappend="${order.badgeColor}">[[${order.status}]]</span>
											</div>

											<!-- Thân card -->
											<div class="d-flex justify-content-between align-items-center">
												<!-- Bên trái: ảnh + thông tin sản phẩm -->
												<div class="d-flex">
													<div
														style="width: 80px; height: 80px; overflow: hidden; border: 1px solid #ddd; border-radius: 4px;">
														<img th:src="@{${order.imageUrl}}" alt="Product"
															class="img-fluid" />
													</div>
													<div class="ms-3">
														<p class="mb-1 fw-semibold">[[${order.productName}]]</p>
														<p class="mb-1 text-muted">Số lượng: [[${order.quantity}]]</p>
														<p class="mb-1 text-muted">Kích cỡ: [[${order.size}]]</p>
													</div>
												</div>

												<!-- Bên phải: đơn giá và tổng -->
												<div
													class="text-end d-flex flex-column justify-content-center align-items-end">
													<p class="mb-1 text-muted">Đơn giá: [[${order.price}]] VND</p> 
													<p class="mb-0 fw-bold text-danger">Tổng: [[${order.totalPrice}]] VND
													</p>
												</div>
											</div>

											<!-- Thông tin thêm -->
											<div class="mt-3">
												<p class="mb-1"><strong>Địa chỉ giao hàng:</strong>
													[[${order.shippingAddress}]]</p>
												<p class="mb-1"><strong>Ghi chú:</strong> [[${order.note}]]</p>
												<p class="mb-0"><strong>Phương thức thanh toán:</strong>
													[[${order.paymentMethodName}]]</p>
											</div>

											<!-- Nút hành động theo trạng thái -->
											<div class="mt-3 text-end">
												<button class="btn btn-sm btn-outline-primary"
													th:if="${order.status == 'Đang giao'}">Theo dõi</button>

												<div class="d-flex justify-content-end gap-2"
													th:if="${order.status == 'Đã giao'}">
													<button class="btn btn-primary btn-review"
														th:data-order-id="${order.orderId}"
														th:data-product-id="${order.productId}"
														th:data-user-id="${user.userId}"
														th:data-product-name="${order.productName}"
														th:data-product-img="${order.imageUrl}"
														th:data-rating="${order.rating}"
														th:data-comment="${order.comment}"
														th:data-review-date="${#dates.format(order.reviewDate, 'dd/MM/yyyy')}"
														th:data-reviewed="${order.reviewed}">

														Đánh giá
													</button>
													<button class="btn btn-sm btn-outline-success">Mua lại</button>
												</div>

												<button class="btn btn-sm btn-outline-secondary"
													th:if="${order.status == 'Đã hủy'}">Chi tiết</button>
											</div>
										</div>
									</div>
								</div>


								<!-- Tab Being Delivered -->
								<div class="tab-pane fade" id="delivering-pane" role="tabpanel">
									<div class="tab-pane fade show active" id="delivering-pane" role="tabpanel">

										<!-- Hiển thị khi không có đơn -->
										<div th:if="${#lists.isEmpty(deliveringOrders)}"
											class="text-center text-muted mt-5">
											<i class="bi bi-truck"></i>
											<p class="mt-2">Không có đơn hàng đang vận chuyển.</p>
										</div>

										<!-- Hiển thị đơn hàng -->
										<div th:each="order : ${deliveringOrders}" class="card shadow-sm mb-3">
											<div class="card-body">

												<!-- Header -->
												<div class="d-flex justify-content-between align-items-start mb-2">
													<h6 class="mb-3">Đơn #[[${order.orderId}]]</h6>
													<span class="badge bg-primary">Đang giao</span>
												</div>

												<!-- Thân card: ảnh + info + giá -->
												<div class="d-flex justify-content-between align-items-center">
													<!-- Bên trái: ảnh + thông tin -->
													<div class="d-flex">
														<div
															style="width: 80px; height: 80px; overflow: hidden; border: 1px solid #ddd; border-radius: 4px;">
															<img th:src="@{${order.imageUrl}}" alt="Product"
																class="img-fluid" />
														</div>
														<div class="ms-3">
															<p class="mb-1 fw-semibold">[[${order.productName}]]</p>
															<p class="mb-1 text-muted">Số lượng: [[${order.quantity}]]</p>
															<p class="mb-1 text-muted">Kích cỡ: [[${order.size}]]</p>
														</div>
													</div>

													<!-- Bên phải: đơn giá + tổng -->
													<div
														class="text-end d-flex flex-column justify-content-center align-items-end">
														<p class="mb-1 text-muted">Đơn giá: [[${order.price}]] VND</p>
														<p class="mb-0 fw-bold text-danger">Tổng:
															[[${order.totalPrice}]] VND</p>
													</div>
												</div>

												<!-- Thông tin thêm -->
												<div class="mt-3">
													<p class="mb-1"><strong>Địa chỉ giao hàng:</strong>
														[[${order.shippingAddress}]]</p>
													<p class="mb-1"><strong>Ghi chú:</strong> [[${order.note}]]</p>
													<p class="mb-0"><strong>Phương thức thanh toán:</strong>
														[[${order.paymentMethodName}]]</p>
												</div>

												<!-- Nút hành động -->
												<div class="mt-3 text-end">
													<button class="btn btn-sm btn-outline-primary">Theo dõi</button>
												</div>

											</div>
										</div>

									</div>
								</div>



								<!-- Tab Completed -->
								<div class="tab-pane fade" id="completed-pane" role="tabpanel">

									<!-- Nếu không có đơn -->
									<div th:if="${#lists.isEmpty(completedOrders)}" class="text-center text-muted mt-5">
										<i class="bi bi-check-circle"></i>
										<p class="mt-2">Không có đơn hàng đã hoàn thành.</p>
									</div>

									<!-- Nếu có đơn -->
									<div th:each="order : ${completedOrders}" class="card shadow-sm mb-3"
										th:attr="data-product-id=${order.productId}, data-user-id=${user.userId}">

										<div class="card-body">
											<!-- Header -->
											<div class="d-flex justify-content-between align-items-start mb-2">
												<h6 class="mb-3">Đơn #[[${order.orderId}]]</h6>
												<span class="badge bg-success">Đã giao</span>
											</div>

											<!-- Thân card -->
											<div class="d-flex justify-content-between align-items-center">
												<!-- Trái: ảnh + info -->
												<div class="d-flex">
													<div
														style="width: 80px; height: 80px; overflow: hidden; border: 1px solid #ddd; border-radius: 4px;">
														<img th:src="@{${order.imageUrl}}" alt="Product"
															class="img-fluid" />
													</div>
													<div class="ms-3">
														<p class="mb-1 fw-semibold">[[${order.productName}]]</p>
														<p class="mb-1 text-muted">Số lượng: [[${order.quantity}]]</p>
														<p class="mb-1 text-muted">Kích cỡ: [[${order.size}]]</p>
													</div>
												</div>

												<!-- Phải: giá -->
												<div
													class="text-end d-flex flex-column justify-content-center align-items-end">
													<p class="mb-1 text-muted">Đơn giá: [[${order.price}]] VND</p>
													<p class="mb-0 fw-bold text-danger">Tổng: [[${order.totalPrice}]] VND
													</p>
												</div>
											</div>

											<!-- Thông tin thêm -->
											<div class="mt-3">
												<p class="mb-1"><strong>Địa chỉ giao hàng:</strong>
													[[${order.shippingAddress}]]</p>
												<p class="mb-1"><strong>Ghi chú:</strong> [[${order.note}]]</p>
												<p class="mb-0"><strong>Phương thức thanh toán:</strong>
													[[${order.paymentMethodName}]]</p>
											</div>

											<!-- Nút hành động -->
											<div class="mt-3 text-end">
												<div class="d-flex justify-content-end gap-2">
													<button class="btn btn-primary btn-review"
														th:data-order-id="${order.orderId}"
														th:data-product-id="${order.productId}"
														th:data-user-id="${user.userId}"
														th:data-product-name="${order.productName}"
														th:data-product-img="${order.imageUrl}"
														th:data-rating="${order.rating}"
														th:data-comment="${order.comment}"
														th:data-review-date="${#dates.format(order.reviewDate, 'dd/MM/yyyy')}"
														th:data-reviewed="${order.reviewed}">

														Đánh giá
													</button>






													<button class="btn btn-sm btn-outline-success">Mua lại</button>
												</div>
											</div>
										</div>
									</div>
								</div>



								<!-- Tab Canceled -->
								<div class="tab-pane fade" id="canceled-pane" role="tabpanel">

									<!-- Khi không có đơn -->
									<div th:if="${#lists.isEmpty(canceledOrders)}" class="text-center text-muted mt-5">
										<i class="bi bi-x-circle"></i>
										<p class="mt-2">Không có đơn hàng bị hủy.</p>
									</div>

									<!-- Khi có đơn -->
									<div th:each="order : ${canceledOrders}" class="card shadow-sm mb-3">
										<div class="card-body">
											<!-- Tiêu đề đơn hàng -->
											<div class="d-flex justify-content-between align-items-start mb-2">
												<h6 class="mb-3">Đơn #[[${order.orderId}]]</h6>
												<span class="badge bg-secondary">Đã hủy</span>
											</div>

											<!-- Thân card -->
											<div class="d-flex justify-content-between align-items-center">
												<!-- Bên trái: ảnh + thông tin sản phẩm -->
												<div class="d-flex">
													<div
														style="width: 80px; height: 80px; overflow: hidden; border: 1px solid #ddd; border-radius: 4px;">
														<img th:src="@{${order.imageUrl}}" alt="Product"
															class="img-fluid" />
													</div>
													<div class="ms-3">
														<p class="mb-1 fw-semibold">[[${order.productName}]]</p>
														<p class="mb-1 text-muted">Số lượng: [[${order.quantity}]]</p>
														<p class="mb-1 text-muted">Kích cỡ: [[${order.size}]]</p>
													</div>
												</div>

												<!-- Bên phải: đơn giá và tổng -->
												<div
													class="text-end d-flex flex-column justify-content-center align-items-end">
													<p class="mb-1 text-muted">Đơn giá: [[${order.price}]] VND</p>
													<p class="mb-0 fw-bold text-danger">Tổng: [[${order.totalPrice}]] VND
													</p>
												</div>
											</div>

											<!-- Thông tin thêm -->
											<div class="mt-3">
												<p class="mb-1"><strong>Địa chỉ giao hàng:</strong>
													[[${order.shippingAddress}]]</p>
												<p class="mb-1"><strong>Ghi chú:</strong> [[${order.note}]]</p>
												<p class="mb-0"><strong>Phương thức thanh toán:</strong>
													[[${order.paymentMethodName}]]</p>
											</div>

											<!-- Nút hành động -->
											<div class="mt-3 text-end">
												<button class="btn btn-sm btn-outline-secondary">Chi tiết</button>
											</div>
										</div>
									</div>
								</div>


							</div>
						</div>



					
						

					</div>
				</div>
				<div class="col-md-3 ps-2">
					<!-- Security Overview -->
					<div class="card border shadow-sm p-3">
						<h5 class="mb-3"><i class="bi bi-shield-lock-fill text-danger"></i> Tổng quan</h5>
						<ul class="list-group list-group-flush small">
							<li class="list-group-item d-flex justify-content-between">
								<span>Số điện thoại:</span>
								<span class="badge bg-success">Đã xác minh</span>
							</li>
							<li class="list-group-item d-flex justify-content-between">
								<span>Email</span>
								<span th:if="${userVerified}" class="badge bg-success">Đã xác minh</span>
								<span th:if="${!userVerified}" class="badge bg-warning text-dark">Chưa xác minh</span>

							</li>
							<li class="list-group-item d-flex justify-content-between">
								<span>Tuổi thọ mật khẩu</span>
								<span class="badge bg-info text-dark" th:text="${passwordAge} + ' days'">50 ngày</span>
							</li>

						</ul>
						<div class="mt-3 text-end">
							<div class="mt-3 text-end">
								<!-- Chỉ hiển thị khi đã xác minh -->
								<a th:if="${userVerified}" href="#"
									class="btn btn-outline-secondary btn-sm disabled">Email đã xác minh</a>

								<!-- Chỉ hiển thị khi chưa xác minh -->
								<a th:if="${!userVerified}" href="#" class="btn btn-outline-secondary btn-sm"
									data-bs-toggle="modal" data-bs-target="#verifyEmailModal">Xác minh Email</a>
							</div>

						</div>

					</div>






				</div>
			</div>
		</div>
	</main>





	<!-- Footer Section Begin -->
	<footer class="bg-dark text-white pt-5 pb-4 mt-auto">
		<div class="container">
			<div class="row">
				<!-- Logo + About -->
				<div class="col-lg-3 col-md-6 col-sm-6 mb-4">
					<div class="mb-3">
						<a href="#"><img src="img/footer-logo.png" alt="Logo"></a>
					</div>
					<p>The customer is at the heart of our unique business model, which includes design.</p>
					<div class="mt-3">
						<a href="#"><img src="img/payment.png" alt="Payments"></a>
					</div>
				</div>

				<!-- Shopping Column 1 -->
				<div class="col-lg-2 offset-lg-1 col-md-3 col-sm-6 mb-4">
					<h6 class="text-uppercase fw-bold">Shopping</h6>
					<ul class="list-unstyled mt-3">
						<li><a href="#" class="text-light text-decoration-none d-block mb-1">Clothing Store</a></li>
						<li><a href="#" class="text-light text-decoration-none d-block mb-1">Trending Shoes</a></li>
						<li><a href="#" class="text-light text-decoration-none d-block mb-1">Accessories</a></li>
						<li><a href="#" class="text-light text-decoration-none d-block mb-1">Sale</a></li>
					</ul>
				</div>

				<!-- Shopping Column 2 -->
				<div class="col-lg-2 col-md-3 col-sm-6 mb-4">
					<h6 class="text-uppercase fw-bold">Shopping</h6>
					<ul class="list-unstyled mt-3">
						<li><a href="#" class="text-light text-decoration-none d-block mb-1">Contact Us</a></li>
						<li><a href="#" class="text-light text-decoration-none d-block mb-1">Payment Methods</a></li>
						<li><a href="#" class="text-light text-decoration-none d-block mb-1">Delivery</a></li>
						<li><a href="#" class="text-light text-decoration-none d-block mb-1">Return & Exchanges</a></li>
					</ul>
				</div>

				<!-- Newsletter -->
				<div class="col-lg-3 offset-lg-1 col-md-6 col-sm-6 mb-4">
					<h6 class="text-uppercase fw-bold">Newsletter</h6>
					<p class="mt-3">Be the first to know about new arrivals, look books, sales & promos!</p>
					<form action="#" class="d-flex border-bottom border-light">
						<input type="text" class="form-control bg-dark border-0 text-white" placeholder="Your email"
							style="border-radius: 0;">
						<button type="submit" class="btn text-white"><i class="bi bi-envelope"></i></button>
					</form>
				</div>
			</div>

			<!-- Copyright -->
			<div class="row mt-4 pt-3 border-top border-secondary">
				<div class="col-12 text-center">
					<p class="mb-0 small">
						Copyright ©
						<script>document.write(new Date().getFullYear());</script>2020
						All rights reserved | This template is made with
						<i class="bi bi-heart text-danger"></i> by
						<a href="https://colorlib.com" target="_blank"
							class="text-danger text-decoration-none">Colorlib</a>
					</p>
				</div>
			</div>
		</div>
	</footer>
	<!-- Footer Section End -->


	<!-- Modal Section -->
	<!-- Modal success -->
	<div class="modal fade" id="successModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header bg-success text-white">
					<h5 class="modal-title">Thành công</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<p th:text="${success}">Thao tác thành công!</p>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal error -->
	<div class="modal fade" id="errorModal" tabindex="-1">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header bg-danger text-white">
					<h5 class="modal-title">Lỗi</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
				</div>
				<div class="modal-body">
					<p th:text="${error}">Có lỗi xảy ra</p>
				</div>
			</div>
		</div>
	</div>



	<!-- Verify Email Modal -->
	<div class="modal fade" id="verifyEmailModal" tabindex="-1" aria-labelledby="verifyEmailModalLabel"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">

				<div class="modal-header bg-warning">
					<h5 class="modal-title" id="verifyEmailModalLabel"><i class="bi bi-envelope-exclamation-fill"></i>
						Xác minh Email của bạn</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>

				<div class="modal-body">
					<p>
					    Chúng tôi sẽ gửi mã xác minh gồm 6 chữ số đến địa chỉ email mà bạn đã đăng ký.
					    Vui lòng kiểm tra hộp thư đến và nhập mã vào biểu mẫu tiếp theo để hoàn tất xác minh.
					</p>

				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
					<button id="confirmVerifyEmailBtn" type="button" class="btn btn-warning">Gửi xác minh về email</button>
				</div>

			</div>
		</div>
	</div>
	<!-- Review Modal -->
	<!-- Modal -->
	<div class="modal fade" id="reviewModal" tabindex="-1" aria-labelledby="reviewModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<form th:action="@{/account/review}" method="post">


					<div class="modal-header">
						<div class="d-flex flex-column">
							<small class="text-muted"><strong>Đơn số:</strong> <span
									id="reviewOrderId">-</span></small>
							<h5 class="modal-title" id="reviewModalLabel">Đánh giá sản phẩm</h5>
						</div>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
					</div>
					<div class="modal-body">
						<div class="d-flex align-items-center mb-3">
							<img id="reviewProductImg" src="/images/no-image.png" class="rounded border me-3"
								style="width: 80px; height: 80px; object-fit: cover;" alt="Product">
							<h6 class="mb-0" id="reviewProductName">Tên sản phẩm</h6>
						</div>
						<input type="hidden" name="productId" id="productIdInput" />
						<input type="hidden" name="userId" id="userIdInput" />
						<input type="hidden" name="rating" id="ratingInput" value="0" />
						<input type="hidden" name="orderId" id="orderIdInput" />
						<div class="mb-3">
							<strong>Đánh giá:</strong>
							<div id="reviewStars" data-rating="0">
								<i class="bi bi-star fs-4" data-value="1"></i>
								<i class="bi bi-star fs-4" data-value="2"></i>
								<i class="bi bi-star fs-4" data-value="3"></i>
								<i class="bi bi-star fs-4" data-value="4"></i>
								<i class="bi bi-star fs-4" data-value="5"></i>
							</div>
						</div>
						<div class="mb-3">
							<label class="form-label"><strong>Bình luận:</strong></label>
							<textarea class="form-control" rows="4" name="comment" placeholder="Nhập nhận xét..."
								id="reviewComment" required></textarea>
						</div>
						<p class="text-muted mb-0">
							<strong>Ngày đánh giá:</strong> <span id="reviewDate">-</span>
						</p>
					</div>
					<div class="modal-footer border-0 justify-content-center">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
						<button type="submit" class="btn btn-primary" id="submitReviewBtn">Gửi đánh giá</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<div class="modal fade" id="reviewedModal" tabindex="-1" aria-labelledby="reviewedModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<form>


					<div class="modal-header">
						<div class="d-flex flex-column">
							<small class="text-muted"><strong>Đơn số:</strong> <span
									id="reviewedOrderId">-</span></small>
							<h5 class="modal-title" id="reviewedModalLabel">Đánh giá sản phẩm</h5>
						</div>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Đóng"></button>
					</div>
					<div class="modal-body">
						<div class="d-flex align-items-center mb-3">
							<img id="reviewedProductImg" src="/images/no-image.png" class="rounded border me-3"
								style="width: 80px; height: 80px; object-fit: cover;" alt="Product">
							<h6 class="mb-0" id="reviewedProductName">Tên sản phẩm</h6>
						</div>
						<input type="hidden" name="productId" id="productIdInput" />
						<input type="hidden" name="userId" id="userIdInput" />
						<input type="hidden" name="rating" id="ratingInput" value="0" />
						<input type="hidden" name="orderId" id="orderIdInput" />
						<div class="mb-3">
							<strong>Đánh giá:</strong>
							<div id="reviewedStars" data-rating="0">
								<i class="bi bi-star fs-4" data-value="1"></i>
								<i class="bi bi-star fs-4" data-value="2"></i>
								<i class="bi bi-star fs-4" data-value="3"></i>
								<i class="bi bi-star fs-4" data-value="4"></i>
								<i class="bi bi-star fs-4" data-value="5"></i>
							</div>
						</div>
						<div class="mb-3">
							<label class="form-label"><strong>Bình luận:</strong></label>
							<p id="reviewedComment" class="form-control bg-light text-muted"
								style="white-space: pre-wrap; min-height: 100px;"></p>
						</div>
						<p class="text-muted mb-0">
							<strong>Ngày đánh giá:</strong> <span id="reviewedDate">-</span>
						</p>
					</div>
					<div class="modal-footer border-0 justify-content-center">
						<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
					</div>
				</form>
			</div>
		</div>
	</div>




	<!-- Warning Modal nếu chưa xác minh -->
	<div class="modal fade" id="emailNotVerifiedModal" tabindex="-1" aria-labelledby="emailNotVerifiedModalLabel"
		aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-header bg-danger text-white">
					<h5 class="modal-title" id="emailNotVerifiedModalLabel">
						<i class="bi bi-exclamation-triangle-fill"></i> Email Chưa Được Xác Minh
					</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>
				<div class="modal-body">
					Bạn cần xác minh email trước khi có thể đổi mật khẩu.
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
					<button id="openVerifyModalBtn" type="button" class="btn btn-danger">Xác minh email</button>
				</div>
			</div>
		</div>
	</div>

	<!-- Modal nhập mã OTP -->
	<div class="modal fade" id="otpModal" tabindex="-1" aria-labelledby="otpModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">

				<div class="modal-header bg-primary text-white">
					<h5 class="modal-title" id="otpModalLabel"><i class="bi bi-shield-lock-fill"></i> Nhập mã xác minh</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				</div>

				<div class="modal-body text-center">
					<p>Nhập mã 6 chữ số đã gửi tới email của bạn:</p>
					<div class="d-flex justify-content-center gap-2">
						<input type="text" class="form-control otp-input" maxlength="1" inputmode="numeric">
						<input type="text" class="form-control otp-input" maxlength="1" inputmode="numeric">
						<input type="text" class="form-control otp-input" maxlength="1" inputmode="numeric">
						<input type="text" class="form-control otp-input" maxlength="1" inputmode="numeric">
						<input type="text" class="form-control otp-input" maxlength="1" inputmode="numeric">
						<input type="text" class="form-control otp-input" maxlength="1" inputmode="numeric">
					</div>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
					<button type="button" class="btn btn-primary" id="submitOtpBtn">Xác minh</button>
				</div>

			</div>
		</div>
	</div>


	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-ndDqU0Gzau9qJ1lfW4pNLlhNTkCfHzAVBReH9diLvGRem5+R9g2FzA8ZGN954O5Q"
		crossorigin="anonymous"></script>
</body>
<script th:inline="javascript">
	/*<![CDATA[*/
	const hasSuccess = /*[[${success != null}]]*/ false;
	const hasError = /*[[${error != null}]]*/ false;

	if (hasSuccess) {
		const modal = new bootstrap.Modal(document.getElementById('successModal'));
		modal.show();
	}

	if (hasError) {
		const modal = new bootstrap.Modal(document.getElementById('errorModal'));
		modal.show();
	}
	/*]]>*/
</script>
<script>
	document.addEventListener('DOMContentLoaded', function () {
		const btn = document.getElementById('confirmVerifyEmailBtn');
		if (btn) {
			btn.addEventListener('click', function () {
				fetch('/account/send-otp', {method: 'POST'})
					.then(res => {
						if (res.ok) {
							alert("Email xác minh đã được gửi!");
							const modal = bootstrap.Modal.getInstance(document.getElementById("verifyEmailModal"));
							modal.hide();
						} else {
							alert("Gửi thất bại");
						}
					})
					.catch(error => {
						console.error("Lỗi khi gửi xác minh email:", error);
						alert("Lỗi hệ thống!");
					});
			});
		}
	});
</script>





<script th:inline="javascript">
/*<![CDATA[*/
	const isVerified = /*[[${userVerified}]]*/ false;

	document.addEventListener('DOMContentLoaded', function () {
		// 👁 Hiện/ẩn mật khẩu
		document.querySelectorAll('.toggle-password').forEach(button => {
			button.addEventListener('click', () => {
				const targetId = button.getAttribute('data-target');
				const input = document.getElementById(targetId);
				const icon = button.querySelector('i');

				if (input.type === 'password') {
					input.type = 'text';
					icon.classList.remove('bi-eye');
					icon.classList.add('bi-eye-slash');
				} else {
					input.type = 'password';
					icon.classList.remove('bi-eye-slash');
					icon.classList.add('bi-eye');
				}
			});
		});

		// 🔒 Form đổi mật khẩu
		const passwordForm = document.getElementById('passwordForm');
		if (passwordForm) {
			passwordForm.addEventListener('submit', function (event) {
				const newPassword = document.getElementById('newPassword').value;
				const confirmPassword = document.getElementById('confirmPassword').value;
				const errorDiv = document.getElementById('passwordError');

				if (newPassword !== confirmPassword) {
					event.preventDefault();
					errorDiv.style.display = 'block';
					return;
				} else {
					errorDiv.style.display = 'none';
				}

				if (!isVerified) {
					event.preventDefault();
					const warnModal = new bootstrap.Modal(document.getElementById('emailNotVerifiedModal'));
					warnModal.show();
				}
			});
		}

		// 📩 Bắt sự kiện mở modal xác minh
		const openVerifyModalBtn = document.getElementById('openVerifyModalBtn');
		if (openVerifyModalBtn) {
			openVerifyModalBtn.addEventListener('click', function () {
				const warnModalEl = document.getElementById('emailNotVerifiedModal');
				const warnModal = bootstrap.Modal.getInstance(warnModalEl);
				warnModal.hide();

				const verifyModal = new bootstrap.Modal(document.getElementById('verifyEmailModal'));
				verifyModal.show();
			});
		}

		// ✅ Mở modal nhập mã OTP khi nhấn nút xác minh (dành để test UI)
		const confirmVerifyEmailBtn = document.getElementById('confirmVerifyEmailBtn');
		if (confirmVerifyEmailBtn) {
			confirmVerifyEmailBtn.addEventListener('click', function () {
				// Tạm thời không fetch, chỉ hiện modal OTP để test
				const otpModal = new bootstrap.Modal(document.getElementById('otpModal'));
				otpModal.show();
			});
		}
	});
/*]]>*/
</script>






<script>
	document.querySelectorAll('.btn-review').forEach(btn => {
		btn.addEventListener('click', function () {
			const isReviewed = this.dataset.reviewed === "true";

			if (isReviewed) {
				console.log("🟢 Đã đánh giá rồi → mở modal reviewedModal");
				handleReviewedModal(btn); // xử lý tách riêng
			} else {
				console.log("🟡 Chưa đánh giá → mở modal reviewModal");
				handleReviewModal(btn); // xử lý tách riêng
			}
		});
	});
</script>
<script>
	document.addEventListener("DOMContentLoaded", function () {
		const stars = document.querySelectorAll("#reviewStars i");
		const ratingInput = document.getElementById("ratingInput");
		let selectedRating = parseInt(ratingInput.value || "0");

		stars.forEach((star, index) => {
			// Click để chọn số sao
			star.addEventListener("click", () => {
				selectedRating = index + 1;
				ratingInput.value = selectedRating;

				// Cập nhật giao diện sao đã chọn
				stars.forEach((s, i) => {
					if (i < selectedRating) {
						s.classList.remove("bi-star", "text-secondary");
						s.classList.add("bi-star-fill", "text-warning");
					} else {
						s.classList.remove("bi-star-fill", "text-warning");
						s.classList.add("bi-star", "text-secondary");
					}
				});
			});
		});
	});
	//Không đụng
</script>

<script>
	function handleReviewedModal(btn) {
	const orderId = btn.dataset.orderId;
	const productId = btn.dataset.productId;
	const userId = btn.dataset.userId;
	const productName = btn.dataset.productName;
	const productImg = btn.dataset.productImg;
	const rating = parseInt(btn.dataset.rating || "0");
	const comment = btn.dataset.comment || "";
	const existingReviewDate = btn.dataset.reviewDate || new Date().toLocaleDateString('vi-VN');

	document.getElementById('reviewedOrderId').textContent = orderId;
	document.getElementById('reviewedProductName').textContent = productName;
	document.getElementById('reviewedProductImg').src = productImg;
	document.getElementById('reviewedComment').textContent = comment;
	document.getElementById('reviewedDate').textContent = existingReviewDate;

	// Gán sao và khóa tương tác
	const stars = document.querySelectorAll('#reviewedStars i');
	stars.forEach((star, index) => {
		if (index < rating) {
			star.classList.remove('bi-star', 'text-secondary');
			star.classList.add('bi-star-fill', 'text-warning');
		} else {
			star.classList.remove('bi-star-fill', 'text-warning');
			star.classList.add('bi-star', 'text-secondary');
		}
	});

	stars.forEach(star => {
		const newStar = star.cloneNode(true);
		newStar.style.pointerEvents = 'none';
		newStar.style.cursor = 'default';
		star.replaceWith(newStar);
	});

	new bootstrap.Modal(document.getElementById('reviewedModal')).show();
}

	function handleReviewModal(btn) {
		const orderId = btn.dataset.orderId;
		const productId = btn.dataset.productId;
		const userId = btn.dataset.userId;
		const productName = btn.dataset.productName;
		const productImg = btn.dataset.productImg;
		const existingRating = parseInt(btn.dataset.rating || "0");
		const existingComment = btn.dataset.comment || "";
		const existingReviewDate = btn.dataset.reviewDate || new Date().toLocaleDateString('vi-VN');

		document.getElementById('reviewOrderId').textContent = orderId;
		document.getElementById('orderIdInput').value = orderId;
		document.getElementById('productIdInput').value = productId;
		document.getElementById('userIdInput').value = userId;
		document.getElementById('reviewProductName').textContent = productName;
		document.getElementById('reviewProductImg').src = productImg;
		document.getElementById('reviewComment').value = existingComment;
		document.getElementById('reviewDate').textContent = existingReviewDate;
		document.getElementById('ratingInput').value = existingRating;

		const stars = document.querySelectorAll('#reviewStars i');
		stars.forEach((star, index) => {
			if (index < existingRating) {
				star.classList.remove('bi-star', 'text-secondary');
				star.classList.add('bi-star-fill', 'text-warning');
			} else {
				star.classList.remove('bi-star-fill', 'text-warning');
				star.classList.add('bi-star', 'text-secondary');
			}
		});
		bootstrap.Modal.getInstance(document.getElementById('reviewedModal'))?.hide();
		new bootstrap.Modal(document.getElementById('reviewModal')).show();
	}
</script>
<script>
	document.addEventListener('DOMContentLoaded', function () {
		const inputs = document.querySelectorAll('.otp-input');

		inputs.forEach((input, index) => {
			// Xử lý nhập từng số
			input.addEventListener('input', (e) => {
				const value = e.target.value;
				if (/^\d$/.test(value)) {
					if (index < inputs.length - 1) {
						inputs[index + 1].focus();
					}
				} else {
					e.target.value = ''; // chỉ cho phép số
				}
			});

			// Xử lý Backspace
			input.addEventListener('keydown', (e) => {
				if (e.key === 'Backspace' && !e.target.value && index > 0) {
					inputs[index - 1].focus();
				}
			});

			// Xử lý Paste
			input.addEventListener('paste', (e) => {
				e.preventDefault();
				const pasteData = (e.clipboardData || window.clipboardData).getData('text').trim();
				if (/^\d{6}$/.test(pasteData)) {
					pasteData.split('').forEach((char, i) => {
						if (inputs[i]) {
							inputs[i].value = char;
						}
					});
					inputs[inputs.length - 1].focus(); // focus ô cuối
				}
			});
		});

		// Gửi OTP khi bấm nút
		document.getElementById('submitOtpBtn').addEventListener('click', function () {
			const code = Array.from(inputs).map(i => i.value).join('');
			if (code.length === 6) {
				fetch('/account/verify-otp', {
					method: 'POST',
					headers: { 'Content-Type': 'application/x-www-form-urlencoded' },
					body: new URLSearchParams({ otp: code })
				})
				.then(res => res.text())
				.then(msg => {
					alert(msg);
					location.reload();
				})
				.catch(err => {
					console.error("Lỗi xác minh OTP:", err);
					alert("Lỗi hệ thống!");
				});
			} else {
				alert("Vui lòng nhập đủ 6 số.");
			}
		});
	});
</script>






</html>